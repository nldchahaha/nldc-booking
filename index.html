<!DOCTYPE html>
<html lang="zh-TW">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>ç†±èˆç¤¾æˆç™¼é è³¼</title>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <style>
Â  Â  Â  Â  .seat { width: 30px; height: 30px; margin: 2px; border-radius: 4px; cursor: pointer; font-size: 10px; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
Â  Â  Â  Â  .available { background-color: #f3f4f6; border: 1px solid #d1d5db; }
Â  Â  Â  Â  .selected { background-color: #ff69b4; color: white; }
Â  Â  Â  Â  .occupied { background-color: #9ca3af; color: white; cursor: not-allowed; opacity: 0.6; }
Â  Â  Â  Â  .bg-pink-main { background-color: #ffc0cb; }
Â  Â  </style>
</head>
<body class="bg-white text-gray-800 pb-24">

Â  Â  <header class="py-8 text-center bg-pink-50">
Â  Â  Â  Â  <h1 class="text-3xl font-extrabold text-pink-500">æˆç™¼é è³¼åŠƒä½ç³»çµ±</h1>
Â  Â  </header>

Â  Â  <main class="max-w-2xl mx-auto p-4 space-y-8">
Â  Â  Â  Â  <section class="space-y-3">
Â  Â  Â  Â  Â  Â  <h2 class="font-bold border-l-4 border-pink-300 pl-2">1. åŸºæœ¬è³‡æ–™</h2>
Â  Â  Â  Â  Â  Â  <input id="name" type="text" placeholder="å§“å" class="w-full border p-3 rounded-xl">
Â  Â  Â  Â  Â  Â  <input id="class_name" type="text" placeholder="ç­ç´š (å¦‚: 206)" class="w-full border p-3 rounded-xl">
Â  Â  Â  Â  </section>

Â  Â  Â  Â  <section class="space-y-4">
Â  Â  Â  Â  Â  Â  <h2 class="font-bold border-l-4 border-pink-300 pl-2">2. é¸æ“‡é …ç›® (å·²è¨­å®šå®šåƒ¹)</h2>
Â  Â  Â  Â  Â  Â  <div class="p-4 border rounded-2xl flex justify-between items-center">
Â  Â  Â  Â  Â  Â  Â  Â  <div><p class="font-bold">é è³¼é–€ç¥¨ <span class="text-pink-500 ml-2">$150</span></p></div>
Â  Â  Â  Â  Â  Â  Â  Â  <input id="ticket_qty" type="number" value="0" min="0" onchange="updateUI()" class="w-16 text-center border-b">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="p-4 border rounded-2xl flex justify-between items-center bg-pink-50">
Â  Â  Â  Â  Â  Â  Â  Â  <div><p class="font-bold">çµ„åˆæ–¹æ¡ˆ (ç¥¨+T-shirt) <span class="text-pink-500 ml-2">$450</span></p></div>
Â  Â  Â  Â  Â  Â  Â  Â  <input id="bundle_qty" type="number" value="0" min="0" onchange="updateUI()" class="w-12 text-center border-b bg-transparent">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-3 border rounded-xl">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm font-bold">T-shirt A ($350)</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="tshirt_qty" type="number" value="0" min="0" onchange="updateUI()" class="w-full mt-1 text-center border-t">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-3 border rounded-xl">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm font-bold">å¤–å¥— ($800)</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="jacket_qty" type="number" value="0" min="0" onchange="updateUI()" class="w-full mt-1 text-center border-t">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </section>

Â  Â  Â  Â  <section>
Â  Â  Â  Â  Â  Â  <h2 class="font-bold border-l-4 border-pink-300 pl-2 mb-2">3. æŒ‘é¸åº§ä½</h2>
Â  Â  Â  Â  Â  Â  <p id="seat-hint" class="text-xs text-gray-500 mb-4">è«‹å…ˆè³¼ç¥¨ä»¥ç²å¾—åŠƒä½è³‡æ ¼</p>
Â  Â  Â  Â  Â  Â  <div class="border rounded-2xl p-4 bg-gray-50 overflow-x-auto">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-[400px] mx-auto">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-pink-200 text-white text-center py-1 rounded mb-6 italic">STAGE èˆå°</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="seat-container" class="grid grid-cols-10 gap-1"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </section>

Â  Â  Â  Â  <div class="fixed bottom-0 left-0 right-0 bg-white border-t p-4 flex items-center justify-between shadow-2xl">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-gray-400">æ‡‰ä»˜ç¸½é¡ (äº¤çµ¦206æ—ä½‘å®¶)</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xl font-bold text-pink-500">$ <span id="total-display">0</span></p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <button onclick="submitOrder()" class="bg-pink-main text-white px-8 py-3 rounded-full font-bold shadow-lg">ç¢ºèªé€å‡º</button>
Â  Â  Â  Â  </div>
Â  Â  </main>

Â  Â  <script>
Â  Â  Â  Â  const GAS_URL = 'https://script.google.com/macros/s/AKfycby-IhhfuYyrAGJG25Q-zIvgOSsTL8p3LShjxidhPdAF24WL9m-PjihVVswQAmZvt6Uz/exec';
Â  Â  Â  Â  const PRICES = { ticket: 150, bundle: 450, tshirt: 350, jacket: 800 };
Â  Â  Â  Â  let selectedSeats = [];
Â  Â  Â  Â  let occupiedSeats = []; // å¾å¾Œå°è®€å–çš„å·²ä½”ç”¨åº§ä½

Â  Â  Â  Â  // åˆå§‹åŒ–åº§ä½èˆ‡è®€å–å¾Œå°è³‡æ–™
Â  Â  Â  Â  window.onload = async function() {
Â  Â  Â  Â  Â  Â  // ç”¢ç”Ÿ 80 å€‹åº§ä½
Â  Â  Â  Â  Â  Â  const container = document.getElementById('seat-container');
Â  Â  Â  Â  Â  Â  for (let i = 1; i <= 80; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  div.className = 'seat available';
Â  Â  Â  Â  Â  Â  Â  Â  div.id = `seat-${i}`;
Â  Â  Â  Â  Â  Â  Â  Â  div.innerText = i;
Â  Â  Â  Â  Â  Â  Â  Â  div.onclick = () => handleSeatSelection(div, i);
Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(div);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // å¾ GAS è®€å–å·²ä½”ç”¨åº§ä½ (éœ€å¯¦ä½œ doGet)
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const res = await fetch(GAS_URL);
Â  Â  Â  Â  Â  Â  Â  Â  occupiedSeats = await res.json();
Â  Â  Â  Â  Â  Â  Â  Â  occupiedSeats.forEach(num => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const el = document.getElementById(`seat-${num}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(el) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.classList.replace('available', 'occupied');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.onclick = null; // è®“å·²é è¨‚çš„ä½ç½®ä¸å¯é»é¸
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  } catch(e) { console.log("æš«ç„¡é ç´„è³‡æ–™"); }
Â  Â  Â  Â  };

Â  Â  Â  Â  function updateUI() {
Â  Â  Â  Â  Â  Â  const t = parseInt(document.getElementById('ticket_qty').value) || 0;
Â  Â  Â  Â  Â  Â  const b = parseInt(document.getElementById('bundle_qty').value) || 0;
Â  Â  Â  Â  Â  Â  const ts = parseInt(document.getElementById('tshirt_qty').value) || 0;
Â  Â  Â  Â  Â  Â  const j = parseInt(document.getElementById('jacket_qty').value) || 0;

Â  Â  Â  Â  Â  Â  const total = (t * PRICES.ticket) + (b * PRICES.bundle) + (ts * PRICES.tshirt) + (j * PRICES.jacket);
Â  Â  Â  Â  Â  Â  document.getElementById('total-display').innerText = total;
Â  Â  Â  Â  Â  Â  document.getElementById('seat-hint').innerText = `è³¼ç¥¨ç¸½æ•¸ï¼š${t + b} å¼µï¼Œå·²é¸ï¼š${selectedSeats.length} ä½`;
Â  Â  Â  Â  }

Â  Â  Â  Â  function handleSeatSelection(div, num) {
Â  Â  Â  Â  Â  Â  const limit = (parseInt(document.getElementById('ticket_qty').value) || 0) +Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (parseInt(document.getElementById('bundle_qty').value) || 0);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (div.classList.contains('selected')) {
Â  Â  Â  Â  Â  Â  Â  Â  div.classList.remove('selected');
Â  Â  Â  Â  Â  Â  Â  Â  selectedSeats = selectedSeats.filter(s => s !== num);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  if (limit === 0) return alert("è«‹å…ˆé¸æ“‡è³¼ç¥¨å¼µæ•¸ï¼");
Â  Â  Â  Â  Â  Â  Â  Â  if (selectedSeats.length >= limit) return alert(`è³¼è²· ${limit} å¼µç¥¨ï¼Œåªèƒ½é¸ ${limit} å€‹ä½å­ã€‚`);
Â  Â  Â  Â  Â  Â  Â  Â  div.classList.add('selected');
Â  Â  Â  Â  Â  Â  Â  Â  selectedSeats.push(num);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  updateUI();
Â  Â  Â  Â  }

async function submitOrder() {
    // 1. å–å¾—ç¥¨æ•¸é™åˆ¶
    const tQty = parseInt(document.getElementById('ticket_qty').value) || 0;
    const bQty = parseInt(document.getElementById('bundle_qty').value) || 0;
    const limit = tQty + bQty; 

    // 2. å–å¾—åŸºæœ¬è³‡æ–™èˆ‡å…¶ä»–å‘¨é‚Š
    const name = document.getElementById('name').value;
    const className = document.getElementById('class_name').value;
    const tsQty = document.getElementById('tshirt_qty').value || 0;
    const jQty = document.getElementById('jacket_qty').value || 0;
    const totalPrice = document.getElementById('total-display').innerText;

    // 3. é˜²å‘†æª¢æŸ¥
    if (!name || !className) {
        return alert("è«‹å¡«å¯«å§“åèˆ‡ç­ç´šï¼");
    }
    if (limit === 0 && (tsQty > 0 || jQty > 0)) {
        // å¦‚æœåªè²·å‘¨é‚Šæ²’è²·ç¥¨ï¼Œå°±ä¸éœ€è¦åŠƒä½ï¼Œé€™éƒ¨åˆ†é‚è¼¯å¯ä»¥è‡ªè¡Œæ±ºå®š
    } else if (selectedSeats.length !== limit) {
        return alert(`åŠƒä½æ•¸é‡ä¸ç¬¦ï¼\nä½ è³¼è²·äº† ${limit} å¼µç¥¨ï¼Œä½†ç›®å‰é¸äº† ${selectedSeats.length} å€‹ä½ç½®ã€‚`);
    }

    // 4. æº–å‚™å‚³é€åˆ°å¾Œå°çš„è³‡æ–™ (æ¬„ä½åç¨±è¦å°æ‡‰åˆ°ä½ çš„ Google Sheet)
    const orderData = {
        name: name,
        class_name: className,
        items: `é è³¼ç¥¨:${tQty}, çµ„åˆ:${bQty}, T-shirt:${tsQty}, å¤–å¥—:${jQty}`,
        seats: selectedSeats.join(', '), // è½‰æˆå­—ä¸²è¼ƒå¥½å­˜å…¥è¡¨æ ¼
        totalPrice: totalPrice,
        timestamp: new Date().toLocaleString() // åŠ å…¥æ™‚é–“æˆ³è¨˜æ–¹ä¾¿å¾Œå°åˆ¤æ–·ä¸€é€±æœŸé™
    };

    try {
        // é¡¯ç¤ºè¼‰å…¥ä¸­
        const btn = event.target;
        btn.innerText = "è™•ç†ä¸­...";
        btn.disabled = true;

        const response = await fetch(GAS_URL, { 
            method: 'POST', 
            mode: 'no-cors', // é‡è¦ï¼šé¿å…è·¨ç¶²åŸŸå•é¡Œï¼Œä½†é€™æœƒè®“ä½ ç„¡æ³•è®€å– response å…§å®¹
            body: JSON.stringify(orderData) 
        });
        
        // é¡¯ç¤ºæˆåŠŸæ˜ç´°
        const summary = `âœ¨ é è³¼æˆåŠŸï¼\nğŸ‘¤ å§“åï¼š${orderData.name}\nğŸ’º åŠƒä½ï¼š${orderData.seats}\nğŸ’° ç¸½é¡ï¼š$${orderData.totalPrice}\n\nğŸ“¢ é‡è¦ï¼šè«‹æ–¼ä¸€é€±å…§äº¤éŒ¢çµ¦ 206æ—ä½‘å®¶ï¼Œå¦å‰‡è¨»éŠ·ï¼`;
        alert(summary);
        
        location.reload(); // é‡æ•´é é¢
    } catch (e) {
        console.error(e);
        alert('ç³»çµ±ç¹å¿™ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–è¯çµ¡ç®¡ç†å“¡ï¼');
        btn.disabled = false;
        btn.innerText = "ç¢ºèªé€å‡º";
    }
}
